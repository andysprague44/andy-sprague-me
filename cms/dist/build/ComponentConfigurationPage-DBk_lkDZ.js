import{bI as I,a_ as v,w as z,a as O,v as R,aa as q,bL as w,r as L,bM as G,j as d,P as E,bN as T,ac as U}from"./strapi-CfbjzxRh.js";import{C as $,T as Q}from"./Form-BWzLQYR8.js";import{u as k}from"./hooks-C4zDG_gs.js";import"./FieldTypeIcon-BEMZwUwa.js";const B=I.injectEndpoints({endpoints:e=>({getComponentConfiguration:e.query({query:t=>`/content-manager/components/${t}/configuration`,transformResponse:t=>t.data,providesTags:(t,o,s)=>[{type:"ComponentConfiguration",id:s}]}),updateComponentConfiguration:e.mutation({query:({uid:t,...o})=>({url:`/content-manager/components/${t}/configuration`,method:"PUT",data:o}),transformResponse:t=>t.data,invalidatesTags:(t,o,{uid:s})=>[{type:"ComponentConfiguration",id:s},{type:"ContentTypeSettings",id:"LIST"}]})})}),{useGetComponentConfigurationQuery:D,useUpdateComponentConfigurationMutation:H}=B,K=()=>{const{slug:e}=v(),{toggleNotification:t}=z(),{formatMessage:o}=O(),{_unstableFormatAPIError:s}=R(),{components:f,fieldSizes:b,schema:r,error:i,isLoading:c,isFetching:F}=q(void 0,{selectFromResult:a=>{const y=a.data?.components.find(n=>n.uid===e),C=a.data?.components.reduce((n,u)=>(n[u.uid]=u,n),{}),p=w(y?.attributes,C),m=Object.entries(a.data?.fieldSizes??{}).reduce((n,[u,{default:j}])=>(n[u]=j,n),{});return{isFetching:a.isFetching,isLoading:a.isLoading,error:a.error,components:p,schema:y,fieldSizes:m}}});L.useEffect(()=>{i&&t({type:"danger",message:s(i)})},[i,s,t]);const{data:g,isLoading:M,isFetching:x,error:l}=D(e??"");L.useEffect(()=>{l&&t({type:"danger",message:s(l)})},[l,s,t]);const h=M||c||x||F,S=L.useMemo(()=>g&&!h?V(g,{schema:r,components:f}):{layout:[],components:{},metadatas:{},options:{},settings:G},[g,h,r,f]),[P]=H(),N=async a=>{try{const y=Object.entries(g?.component.metadatas??{}).reduce((p,[m,{edit:n,list:u}])=>{const{__temp_key__:j,size:J,name:W,...A}=a.layout.flatMap(_=>_.children).find(_=>_.name===m)??{};return p[m]={edit:{...n,...A},list:u},p},{}),C=await P({layouts:{edit:a.layout.map(p=>p.children.reduce((m,{name:n,size:u})=>n!==Q?[...m,{name:n,size:u}]:m,[])),list:g?.component.layouts.list},settings:U(a.settings,"displayName",void 0),metadatas:y,uid:e});"data"in C?t({type:"success",message:o({id:"notification.success.saved",defaultMessage:"Saved"})}):t({type:"danger",message:s(C.error)})}catch{t({type:"danger",message:o({id:"notification.error",defaultMessage:"An error occurred"})})}};return h?d.jsx(E.Loading,{}):l||i||!r?d.jsx(E.Error,{}):d.jsxs(d.Fragment,{children:[d.jsx(E.Title,{children:`Configure ${S.settings.displayName} Edit View`}),d.jsx($,{onSubmit:N,attributes:r.attributes,fieldSizes:b,layout:S})]})},V=(e,{schema:t,components:o})=>{const s=T(e.component.layouts.edit,t?.attributes,e.component.metadatas,{configurations:e.components,schemas:o}),f=Object.entries(e.components).reduce((r,[i,c])=>(r[i]={layout:T(c.layouts.edit,o[i].attributes,c.metadatas),settings:{...c.settings,icon:o[i].info.icon,displayName:o[i].info.displayName}},r),{}),b=Object.entries(e.component.metadatas).reduce((r,[i,c])=>({...r,[i]:c.edit}),{});return{layout:[s],components:f,metadatas:b,options:{...t?.options,...t?.pluginOptions},settings:{...e.component.settings,displayName:t?.info.displayName}}},et=()=>{const e=k(t=>t.admin_app.permissions.contentManager?.componentsConfigurations);return d.jsx(E.Protect,{permissions:e,children:d.jsx(K,{})})};export{K as ComponentConfigurationPage,et as ProtectedComponentConfigurationPage};
